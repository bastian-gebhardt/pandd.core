<!DOCTYPE project>
<project name="pandd_build_impl" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    	Implementation from Build file for Pandd Framework Developing
    	(there are nothing to configure in this file)
    </description>

	<taskdef resource="net/sf/antcontrib/antlib.xml"/>
	
	<artifact:pom id="pomfile" file="pom.xml" />
	
	  <macrodef name="resolveProperty">
	    <attribute name="property" />
	  	<attribute name="part1" />
	  	<attribute name="part2" />
	    <sequential>
	      <property name="@{property}" value="${@{part1}.@{part2}}" />
	    </sequential>
	  </macrodef>

	<property name="package_file" value="${pomfile.artifactId}-${pomfile.version}"/>

	<resolveProperty property="packfile" part1="pomfile.properties.pandd.packaging" part2="${pomfile.packaging}" />

	<import file="${basedir}/lib/${packfile}" />

	<available file="lib/${pomfile.properties.pandd.bootstrap.dev}" property="bootstrapfile-available" />
	<available file="lib/${pomfile.properties.pandd.postupdate}" property="postupdateplugin-available" />
	
    <target name="clean_dist">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="dist/compiled" includes="**/*" excludes=".gitignore" />
            <fileset dir="dist" includes="**/*" excludes="compiled/*" />
        </delete>
        <defaultexcludes add="**/.gitignore"/>
    </target> 
    
    <target name="clean_lib">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="lib" includes="**/*" excludes=".gitignore" />
        </delete>       
        <defaultexcludes add="**/.gitignore"/>
     </target> 
    
    <target name="clean" depends="clean_lib, clean_dist" />
	
	
	<target name="update-dependencies_stage2" depends="provide-bootstrap">
		<runtarget target="post_update-dependencies"/>
	</target>

	
	<target name="provide-bootstrap" if="${bootstrapfile-available}">
		<ant antfile="lib/${pomfile.properties.pandd.bootstrap.dev}" target="_provide" />	
	</target>
	
	<target name="post_update-dependencies" if="${postupdateplugin-available}">
		<ant antfile="lib/${pomfile.properties.pandd.postupdate}" target="pandd_postupdate_run" />	
	</target>
		
	<target name="_test_syntax">
		<exec executable="resources/syntax_check.sh" failonerror="true" />
	</target>

	<target name="_test_phpunit">
		<exec executable="php" failonerror="true">
			<arg line="resources/phpunit.php -c resources/phpunit.xml" />
		</exec>
	</target>	
	
	<target name="test" depends="_test_syntax, _test_phpunit" />

	<target name="package" depends="clean_dist" >
		<antcallback target="_package" return="file-type"/>
	</target>
	
	<target name="mvn_install" depends="package">
				<artifact:install file="dist/${pomfile.artifactId}-${pomfile.version}.${file-type}">
				  	<pom refid="pomfile"/>
			     </artifact:install>				
	</target>
	<target name="mvn_deploy" depends="mvn_install" >
      <artifact:pom id="deploypom" file="pom.xml" />
				<artifact:deploy file="dist/${pomfile.artifactId}-${pomfile.version}.${file-type}">
				  	<pom refid="deploypom"/>
			     </artifact:deploy>				

	</target>
</project>