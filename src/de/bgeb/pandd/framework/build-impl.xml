<!DOCTYPE project>
<project name="pandd_build_impl" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
    	Implementation from Build file for Pandd Framework Developing
    	(there are nothing to configure in this file)
    </description>

	<taskdef resource="net/sf/antcontrib/antlib.xml"/>
	
	<artifact:pom id="pomfile" file="pom.xml" />
	
	  <macrodef name="resolveProperty">
	    <attribute name="property" />
	  	<attribute name="part1" />
	  	<attribute name="part2" />
	    <sequential>
	      <property name="@{property}" value="${@{part1}.@{part2}}" />
	    </sequential>
	  </macrodef>

	<property name="package_file" value="${pomfile.artifactId}-${pomfile.version}"/>

	<resolveProperty property="packfile" part1="pomfile.properties.pandd.packaging" part2="${pomfile.packaging}" />

	<include file="${basedir}/lib/${packfile}" as="packfile" />

	
    <target name="clean_dist">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="dist/compiled" includes="**/*" excludes=".gitignore" />
            <fileset dir="dist" includes="**/*" excludes="compiled/*" />
        </delete>
        <defaultexcludes add="**/.gitignore"/>
    </target> 
    
    <target name="clean_lib">
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="lib" includes="**/*" excludes=".gitignore" />
        </delete>       
        <defaultexcludes add="**/.gitignore"/>
     </target> 
    
    <target name="clean" depends="clean_lib, clean_dist" />
	
	
	<target name="update-dependencies_stage2">
		<runtarget target="post_update-dependencies"/>
	</target>

	<target name="post_update-dependencies">
	</target>
		
	<target name="test">
		<echo message="not implemented yet" />
	</target>

	<target name="publish" depends="mvn_package" />

	
	<target name="mvn_package" >
		<antcallback target="packfile._package" return="file-type"/>
	</target>
	
	<target name="mvn_install" depends="mvn_package">
		<artifact:install>
			<attach file="dist/${pomfile.artifactId}-${pomfile.version}.${file-type}" type="${file-type}" />
			<pom refid="pomfile"/>
		</artifact:install>
	</target>
	<target name="mvn_deploy" depends="mvn_install" >
		<!-- bugfix, avoids deploying artifact twice -->
	  <artifact:pom id="bugfixpom" file="pom.xml" />
	  <artifact:deploy>
		<attach file="dist/${pomfile.artifactId}-${pomfile.version}.${file-type}" type="${file-type}" />
	  	<pom refid="bugfixpom"/>
	  </artifact:deploy>

	</target>
</project>