<project name="setup" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">
    <description>
        Create a maven supported PHP-Project
    </description>

    <property name="project_groupId" value="de.bgeb" />
    <property name="project_artifactId" value="test_lib" />
    <property name="project_version" value="0.1.0-SNAPSHOT" />

    <property name="arche_groupId" value="de.bgeb.pandd.arche" />
    <property name="arche_artifactId" value="commonlib" />
    <property name="arche_version" value="0.2.0-SNAPSHOT" />
    
    <property name="mvn_download_repo" value="http://localhost:8080/archiva/repository/php-release/" />

	
    <!-- nothing to configure below -->     

    <!-- Betriebssystemunabhaengige Loesung finden -->
    <exec executable="sed" inputstring="${arche_groupId}" outputproperty="arche_groupIdAsPath">
      <arg value="s/\./\//g"/>
    </exec>    
    
    <!-- downloads pandd framework from maven repo server -->
   <target name="_prepare" >
        <defaultexcludes remove="**/.gitignore"/>
        <delete includeEmptyDirs="true">
            <fileset dir="." excludes="setup.xml .project"/>
        </delete>
        <artifact:remoteRepository id="remote.repository" url="${mvn_download_repo}" />
        <artifact:pom id="virtual-pomfile" groupId="de.bgeb" artifactId="pandd-setup" version="1.0.0" name="PHP Lib Project">
            <dependency groupId="${arche_groupId}" artifactId="${arche_artifactId}" version="${arche_version}" scope="test" />
        	<dependency groupId="de.bgeb.pandd" artifactId="framework" version="0.1.0-SNAPSHOT" />
        </artifact:pom> 
        
        <artifact:dependencies filesetId="deps.fileset" useScope="test">
            <pom refid="virtual-pomfile"/>
            <remoteRepository refid="remote.repository" />
        </artifact:dependencies>
        <unzip dest="lib/">
            <fileset refid="deps.fileset" />
        </unzip>
        <defaultexcludes add="**/.gitignore"/>
    </target>

    <target name="setup" depends="_prepare">
        <ant antfile="lib/${arche_groupIdAsPath}/${arche_artifactId}/build-impl.xml" dir="." target="setup"/>
    </target>   
    
</project>